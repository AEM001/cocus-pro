一、你的策略（精确细化）
•  初始掩码
•  用 SAM 的框预测得到初始掩码 M0_sam；
•  若提供 prior 掩码，则与 M0_sam 取交，作为 M0，确保编辑域受先验限制。
•  允许点域
•  以 ROI 为中心，按比例轻度扩张出 allowed_box，并构建 allowed_mask；后续所有点与掩码更新都以此域为硬门控，防止外溢。
•  迭代，仅沿边界语义精修（无网格）
•  在当前掩码 M 的边界上均匀采样若干候选边界点（限制在 allowed_box 内）。
•  对每个边界点，向内/向外各自进行“近邻探索”：
◦  向内：在半径 band_in 的范围内，找到最近的前景像素 inside；
◦  向外：在半径 band_out 的范围内，找到最近的背景像素 outside。
•  对 inside 与 outside 分别生成小圆盘区域掩码（半径 r_in/r_out），与 allowed_mask 取交，形成用于评分的 alpha 掩码。
•  语义评分与点选择：
◦  用 Alpha-CLIP 对每个小圆盘区域进行语义评分；
◦  将外侧候选按分数从高到低选为“正点”（表示需要向外扩张的区域）；
◦  将内侧候选按分数从低到高选为“负点”（表示需要向内收缩的区域）；
◦  用 pos_neg_ratio 和 max_total 控制本轮正负点的数量分配。
•  用选出的正负点调用 SAM 点提示接口，更新掩码 → 硬门控到 allowed_mask → 平滑；
•  若与上一轮 IoU 足够高（> 1 - eps），则早停；否则进入下一轮；首轮可配置是否跳过更新以保留初始质感。
•  终止
•  达到最大迭代次数、无可用点或满足早停条件时返回最终掩码。

二、已完成的修改
•  将主流程切换为“仅沿边界的语义精修”，完全移除了网格评分/细分路径在主流程中的使用。
•  保留了语义评分的边界点策略（Alpha-CLIP 参与），并支持首轮跳过更新、小 ROI 点数自适应、硬门控与早停等。
•  移除了遗留的几何边界精修函数，避免与语义驱动策略混淆。